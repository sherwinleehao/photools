#!/usr/bin/python3
# -*- coding: utf-8 -*-

"""
Image Tool Library

Author: Sherwin Lee
Website: Sherwinleehao.com
Last edited: 20180824

Task:

1.Drag and Drop to import the files

2.load image in the background

"""

import sys
from PyQt5.QtWidgets import (QWidget, QSlider, QApplication, QHBoxLayout, QVBoxLayout)
from PyQt5.QtCore import QObject, Qt, pyqtSignal
from PyQt5.QtGui import QPainter, QFont, QColor, QPen
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *
from PyQt5.QtGui import *
import os, random
import uuid
import math

class Communicate(QObject):
    updateBW = pyqtSignal(int)


class AudioWaveform(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        self.mirro = False
        self.scale = 100
        self.value = 75
        self.wave = [22, 3202, 18269, 10461, 13169, 11421, 10315, 12093, 13990, 9218, 7281, 6489, 6687, 5098, 4287, 4357, 4285, 14456, 12293, 11666, 10777, 9927, 11915, 14387, 9823, 8938, 7437, 5820, 4981, 4513, 3973, 3934, 6257, 17888, 12371, 12960, 12171, 10237, 13952, 14366, 9625, 8794, 6688, 5650, 5860, 7209, 6525, 4171, 12817, 12289, 10272, 10962, 12846, 10540, 16499, 12160, 8764, 9560, 8233, 5850, 4114, 3059, 2860, 7369, 8475, 4388, 4191, 2729, 2771, 1959, 1847, 1434, 994, 961, 697, 936, 577, 358, 252, 12304, 14001, 13825, 10465, 12396, 14756, 12947, 6813, 9204, 10856, 10239, 9621, 12056, 7985, 5695, 14575, 17634, 10372, 10074, 11105, 9806, 11537, 9009, 10229, 10684, 12594, 12693, 16164, 12311, 5962, 9939, 15850, 13643, 12928, 10566, 12961, 10791, 10605, 8189, 11079, 12193, 10885, 9363, 12030, 10293, 8675, 6381, 6491, 4099, 7387, 11640, 11343, 7511, 4814, 2903, 3985, 2051, 1371, 953, 715, 474, 1823, 14686, 17147, 15735, 14070, 13091, 14763, 15006, 8423, 12598, 12523, 12410, 9392, 12433, 8241, 4762, 12461, 15846, 13709, 15671, 11563, 12876, 13797, 12555, 11130, 12753, 14299, 14333, 13482, 13088, 6917, 11190, 16346, 14493, 14857, 12851, 14469, 15081, 10767, 7405, 10433, 10241, 10505, 13366, 16467, 16186, 15011, 12193, 13032, 14571, 10114, 13572, 14433, 12281, 10986, 12545, 15053, 13683, 16062, 16932, 14357, 13624, 11941, 19839, 18674, 18808, 21672, 31858, 23089, 26269, 21298, 32767, 20735, 8633, 3084, 1629, 11958, 24770, 31542, 31281, 24928, 25916, 32767, 30165, 28362, 25816, 28579, 20204, 22539, 24399, 32767, 22589, 23879, 30540, 32767, 21544, 29338, 20908, 32767, 21510, 29237, 25908, 31765, 25191, 15056, 31498, 22899, 25619, 23965, 27274, 31310, 23774, 28688, 32767, 28651, 23912, 22193, 22844, 14074, 22034, 24655, 32767, 29178, 25158, 15218, 32452, 24354, 22402, 27329, 30337, 21276, 25100, 32698, 31775, 26082, 27435, 32767, 32676, 32548, 30338, 32767, 32759, 26561, 28940, 32767, 30135, 30717, 26345, 32649, 22283, 24633, 24905, 31290, 15786, 32767, 22268, 32767, 28871, 31158, 20806, 29501, 26287, 28993, 32379, 31518, 25517, 17852, 30334, 22411, 25842, 24554, 32317, 30076, 30084, 29293, 32709, 26878, 29419, 21747, 25555, 15786, 11068, 10823, 16016, 17709, 12447, 9403, 23423, 14806, 20290, 17540, 13319, 13388, 15388, 9244, 9142, 6556, 5993, 4907, 5102, 5808, 4751, 15826, 17100, 14762, 15398, 15096, 14188, 17517, 12628, 9803, 7601, 7279, 6307, 11371, 9363, 10527, 9583, 27067, 17035, 17737, 17720, 20263, 25331, 25557, 16277, 11901, 9932, 10091, 11378, 11671, 12147, 8909, 25431, 16427, 15615, 16458, 16287, 12754, 24576, 16922, 13047, 11654, 12688, 12175, 10341, 8461, 5588, 4186, 22411, 15992, 15845, 15781, 14880, 14602, 14947, 14904, 13945, 18984, 14523, 15881, 14028, 8371, 5425, 21690, 16376, 14002, 16589, 13345, 11764, 13600, 19709, 16808, 14573, 18480, 12469, 18445, 13133, 8522, 15316, 25817, 14728, 12224, 15229, 14609, 13604, 18519, 13016, 15365, 16546, 14407, 20649, 14270, 13070, 16293, 16505, 10539, 14715, 12465, 17781, 9540, 6482, 16343, 15105, 8459, 7179, 15345, 17333, 11033, 11683, 7608, 22910, 20910, 15475, 20975, 17533, 18551, 18272, 18205, 15195, 15460, 16100, 18107, 14840, 8174, 17523, 21822, 16043, 20386, 20375, 20609, 14702, 14806, 20706, 19118, 22430, 16913, 13514, 15663, 14891, 11012, 22780, 24235, 18321, 21842, 16427, 19319, 19681, 19457, 23660, 14888, 17648, 15152, 21242, 25534, 23741, 19746, 21045, 23727, 25586, 26563, 20774, 18824, 19378, 23524, 16362, 24053, 24578, 24965, 28598, 21140, 24056, 23293, 24344, 19502, 30188, 25614, 30975, 27109, 29469, 32767, 32767, 13981, 3533, 29632, 22664, 26047, 32767, 32767, 29919, 28421, 28716, 32755, 29522, 29711, 26926, 32723, 23604, 25930, 25597, 32559, 23967, 25959, 32676, 30891, 20390, 29736, 32705, 25881, 28005, 31710, 31585, 27709, 24033, 13608, 27918, 26206, 28080, 26446, 29542, 25811, 30807, 26311, 29464, 28640, 23478, 21164, 22461, 19373, 24963, 30390, 32767, 31260, 24303, 28499, 27782, 24346, 22819, 30543, 32518, 26713, 24343, 32276, 31543, 29458, 25638, 32767, 26737, 32767, 31598, 32767, 32740, 32767, 30376, 32767, 29421, 31253, 30254, 32550, 24548, 23560, 26660, 31094, 26889, 32767, 28273, 32184, 22430, 32767, 28241, 30522, 27472, 24122, 32767, 30823, 25446, 14668, 32575, 25209, 30959, 23751, 31045, 27662, 31605, 22352, 32507, 26889, 32453, 26178, 32607, 21895, 29770, 23157, 31813, 29739, 32767, 32713, 30388, 24985, 25941, 32767, 28117, 24688, 32209, 31576, 21291, 22997, 20973, 32767, 19810, 20546, 21603, 32767, 18969, 19266, 15193, 32753, 17984, 18382, 24811, 27037, 15269, 19243, 31285, 28164, 24843, 22250, 31704, 23218, 17350, 18555, 28518, 19956, 19362, 32114, 23554, 17215, 19286, 16165, 32767, 18536, 20711, 28508, 27991, 19265, 16893, 13358, 32671, 18807, 17448, 24473, 29107, 16719, 23963, 29407, 30178, 27759, 27326, 30347, 21679, 15597, 13824, 19551, 14160, 19973, 13986, 17589, 16828, 24945, 17025, 25542, 24249, 28308, 21018, 27270, 23652, 31586, 21550, 27238, 23487, 32767, 26192, 32767, 32767, 32767, 32767, 32767, 32767, 32767, 32767, 32767, 29253, 32020, 32767, 32767, 32683, 31011, 30535, 30886, 22980, 32646, 32767, 30614, 32767, 27003, 32767, 29018, 30973, 28547, 32767, 25787, 31404, 29204, 29661, 32445, 28439, 32767, 30480, 32767, 29511, 32767, 27977, 31553, 28879, 32767, 30717, 32734, 28187, 22312, 13472, 30322, 28358, 32767, 29219, 27701, 30402, 31705, 32767, 31587, 28494, 32767, 32767, 32767, 32767, 32767, 32767, 30940, 32767, 32767, 32767, 32767, 32767, 32767, 32753, 32767, 32767, 32767, 32767, 32767, 30423, 32767, 30977, 32291, 32767, 21538, 29548, 26653, 32767, 28565, 25114, 32766, 32767, 27392, 32767, 32767, 32767, 32733, 26777, 31020, 28425, 32709, 26987, 32767, 28206, 26146, 29535, 32767, 29095, 32767, 22989, 18863, 19300, 14305, 12842, 17375, 19787, 21078, 14668, 7919, 13271, 10158, 8511, 9762, 11614, 10350, 8246, 5773, 8834, 9311, 10937, 10254, 5937, 7045, 2704, 2454, 1695, 1342, 956, 910, 767, 474, 6983, 6302, 10274, 7773, 7462, 5111, 5777, 2899, 2178, 2255, 1805, 2369, 2947, 8061, 5482, 4792, 6244, 10348, 9132, 9926, 9434, 7254, 4633, 3043, 2444, 1812, 1325, 938, 5571, 3866, 3053, 6968, 5301, 4215, 3023, 6854, 4806, 6527, 4491, 5424, 5331, 2529, 3170, 2391, 1595, 1955, 1426, 1174, 1192, 1017, 1539, 1409, 1263, 1704, 2607, 3143, 4148, 3882, 4053, 4404, 5076, 6011, 6936, 7171, 8118, 9274, 12162, 8620, 7168, 7215, 7316, 6866, 6433, 4195, 5517, 4197, 3463, 3697, 2833, 2767, 2061, 2119, 2191, 1789, 1498, 1382, 1272, 1326, 1144, 4177, 4142, 2901, 2802, 1955, 1351, 1082, 1155, 826, 692, 630, 509, 442, 436, 476, 486, 445, 440, 275, 221, 190, 224, 175, 142, 149, 117, 101, 102, 87, 74, 58, 61, 48, 39, 25, 20, 17, 17, 19, 16, 17, 16, 18, 41, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        # print(self.wave)

    def setScele(self, scale):
        self.scale = scale

    def paintEvent(self, e):
        qp = QPainter()
        qp.begin(self)
        self.drawWidget(qp)
        qp.end()

    def drawWidget(self, qp):
        size = self.size()
        w = size.width()
        h = size.height()
        print("Size :",w,h)
        pen = QPen(QColor(200, 20, 20), 1, Qt.SolidLine)

        # qp.setRenderHint(QPainter.Antialiasing)
        qp.setPen(pen)
        qp.setBrush(Qt.NoBrush)
        qp.drawRect(0, 0, w-1, h-1)

        waveMax = max(self.wave)
        # print("Max Wave Value:",waveMax)
        mirro = self.mirro
        index= 0
        for i in self.wave:
            v = i / waveMax * self.scale/100

            v = math.pow(v,0.5) #set the value unlinear

            l = v * h
            if mirro :
                qp.drawLine(index, (h-l)/2, index, (h-l)/2+l)
            else:
                qp.drawLine(index, h-l, index, h)
            index += 1


class Example(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        self.AWF = AudioWaveform()
        sld = QSlider(Qt.Horizontal, self)
        sld.setFocusPolicy(Qt.NoFocus)
        sld.setRange(0, 500)
        sld.setValue(100)

        tester = QPushButton("Vertical Mirro", self)
        Vbox = QVBoxLayout()
        Vbox.addWidget(self.AWF)
        Vbox.addWidget(sld)
        Vbox.addWidget(tester)

        self.c = Communicate()
        self.c.updateBW[int].connect(self.AWF.setScele)
        sld.valueChanged[int].connect(self.changeScele)

        self.setLayout(Vbox)
        self.setGeometry(-1200, 300, 1024, 300)
        self.setWindowTitle("Pre-Research")

        tester.clicked.connect(self.tester)

        self.show()

    def tester(self):
        self.AWF.mirro = not self.AWF.mirro
        self.AWF.repaint()
        print("This is Tester!")
        print("Mirro:", int(self.AWF.mirro))

    def changeScele(self, value):
        self.c.updateBW.emit(value)
        self.AWF.repaint()



if __name__ == "__main__":
    app = QApplication(sys.argv)
    ex = Example()
    sys.exit(app.exec_())
